import re

# Definición de las reglas de producción
productions = {
    '<Start>': ['<Expr>'],
    '<Expr>': ['<Expr><Op><Expr>', '<Filter>(<Expr>)', '<Terminal>'],
    '<Filter>': ['<Gau>', '<Arith>', '<Lap>'],
    '<Gau>': ['ft.Gau1', 'ft.Gau2'],
    '<Lap>': ['ft.LapG1', 'ft.LapG2', 'ft.Lap'],
    '<Arith>': ['ft.HEq', 'ft.Sqrt', 'ft.Log'],
    '<Op>': ['+', '-', '*'],
    '<Terminal>': ['img']
}


# Función para expandir un símbolo no terminal usando el genotipo
def expand_symbol(symbol, genotype, gen_index):
    if symbol in productions:
        choices = productions[symbol]
        choice_index = genotype[gen_index] % len(choices)
        return choices[int(choice_index)], gen_index + 1
    return symbol, gen_index


# Función principal para generar una cadena desde el símbolo de inicio
def generate(genotype):
    current_string = "<Start>"
    gen_index = 0

    # Expansión iterativa
    while True:
        # Buscar todos los no terminales en la cadena actual
        non_terminals = re.findall(r'<[^>]+>', current_string)
        if gen_index == (len(genotype) - 1):
            gen_index = 0
        if not non_terminals and current_string == 'img':
            current_string = "<Start>"
        if not non_terminals and current_string == 'img-img':
            current_string = "<Start>"
        if not non_terminals:
            break

        # Reemplazar el primer no terminal encontrado
        for non_terminal in non_terminals:
            expansion, gen_index = expand_symbol(non_terminal, genotype, gen_index)
            current_string = current_string.replace(non_terminal, expansion, 1)
            break  # Salir del bucle para reiniciar la búsqueda de no terminales

    return current_string


population = [[110.76620197, 239.00071016, 152.27933393, 56.21829946,
               9.31822081, 214.67025878, 214.24674861, 188.22015281,
               156.85695831, 67.81211358, 23.11669074, 1.05403792,
               56.00241592, 7.56875348, 186.08094726, 230.78310987,
               59.4227414, 121.97499722, 227.42275054, 79.19031497,
               156.49626734, 102.39777711, 9.98931193, 127.91878381,
               125.34112293, 119.70673579, 159.32347923, 123.43526251,
               145.63843651, 193.28200537, 37.07660045, 22.72015018,
               7.38969641, 68.25596405, 231.74577859, 109.558201,
               50.63772649, 36.55633538, 35.71741184, 67.11423271,
               77.24686319, 175.51210237, 73.33986792, 186.86676953,
               171.17014691, 186.59494108, 126.57834758, 242.81137903,
               111.18112062, 226.85377672], [215.98429908, 149.91151212, 128.94134202, 93.39851197,
                                             179.20670772, 133.65775821, 176.1343979, 247.52964154,
                                             147.83034818, 88.66590288, 127.02463192, 155.57680897,
                                             227.16529226, 102.11981042, 40.30065297, 158.19268868,
                                             173.10988807, 119.35019227, 214.68456105, 231.42182613,
                                             173.76281285, 128.09197106, 128.41452601, 246.55839908,
                                             69.57540419, 194.53885765, 180.36143901, 237.7464812,
                                             240.8192773, 85.77604083, 133.58406579, 224.51340465,
                                             221.2025663, 36.71065968, 87.27812735, 164.732238,
                                             216.20267726, 219.94449573, 230.21474775, 201.71002978,
                                             222.83670014, 194.527018, 237.27956873, 14.45952675,
                                             48.29088044, 69.28198167, 30.95156497, 145.30705828,
                                             1.90793301, 228.16620447],
              [14.94016541, 184.56817534, 16.64172964, 160.22602623,
               59.7108594, 79.44415123, 86.29340461, 36.52326843,
               8.26562293, 184.204389, 27.20304546, 153.81806895,
               36.79070696, 196.47109292, 167.4704161, 139.07091592,
               243.23973215, 137.56737722, 84.88746579, 127.72051815,
               47.06980796, 227.26735839, 189.20984299, 152.5136348,
               142.73465506, 214.55823079, 121.08231582, 236.07557994,
               219.04192297, 225.20606028, 157.56619139, 74.3407876,
               74.66547515, 131.64748161, 31.80941048, 7.00460856,
               131.33252352, 53.0284561, 90.06562577, 180.66562693,
               116.27433062, 159.44606013, 90.4425894, 141.01924742,
               43.32051461, 23.91606303, 222.08449939, 213.79159233,
               176.01688663, 179.10165173], [73.19648289, 168.18389006, 55.59048271, 1.79140792,
                                             28.04777771, 194.83852975, 111.56752109, 235.70318448,
                                             32.07832198, 44.71238021, 81.66091156, 190.06772468,
                                             155.070697, 95.90059542, 103.9210975, 155.58464123,
                                             48.43161954, 151.00400199, 50.31984999, 23.0250277,
                                             117.83953557, 196.43449492, 210.46579232, 158.63658945,
                                             166.338349, 108.74252694, 100.21914729, 76.87806896,
                                             211.67015621, 44.69110523, 248.65648765, 15.41684092,
                                             110.37429449, 168.39311589, 197.61624202, 31.34214434,
                                             21.78780403, 65.63290954, 4.04823099, 44.0980673,
                                             47.06371831, 88.42520922, 31.1403626, 210.47152961,
                                             9.58541963, 173.83993489, 18.27420004, 96.24930678,
                                             108.05265414, 199.01140405],
              [217.08759359, 170.2847499, 43.43427435, 97.84433772,
               119.37838439, 30.47625103, 87.49185922, 33.85406087,
               92.46225988, 88.87040255, 76.8021808, 207.29103702,
               97.79551844, 147.93664405, 158.1196787, 58.13996088,
               128.91319962, 61.87494892, 251.97666906, 210.64760589,
               96.8293657, 13.28637037, 85.38633557, 41.7097527,
               44.54580301, 45.13670937, 86.30147126, 67.37340167,
               231.47969157, 114.61371425, 168.65109578, 250.51562778,
               24.62317058, 25.56256673, 170.03773502, 95.10572357,
               41.8165883, 110.1987908, 1.59880394, 15.44087975,
               232.89372353, 118.61083962, 145.63653701, 9.43446117,
               34.95105974, 29.89666827, 95.39543541, 236.99088323,
               56.9698119, 251.02655126], [134.06730501, 129.33050162, 227.31166665, 186.84026346,
                                           87.84408913, 148.67170979, 208.54798302, 150.24522914,
                                           88.42922171, 236.55467745, 111.71601267, 84.9894906,
                                           45.39708902, 75.30793405, 166.07779583, 38.70461367,
                                           249.86555648, 130.77047884, 115.85032161, 249.04818793,
                                           65.85591279, 169.11283522, 184.13386819, 25.54426525,
                                           109.12773274, 210.54000713, 57.37938522, 52.15991587,
                                           143.48533529, 218.33597673, 66.21201565, 75.20700331,
                                           13.50718943, 153.86332132, 40.09396366, 211.80383496,
                                           44.44445128, 251.56519238, 83.53796613, 127.85951401,
                                           16.24854416, 94.67199839, 28.76192709, 220.41474933,
                                           191.87642329, 96.20173377, 106.90561327, 111.78067643,
                                           232.81168853, 242.93748425],
              [70.7974038, 38.09631289, 122.68440554, 14.93300722,
               41.03320967, 226.88692485, 12.1061842, 107.79331112,
               75.72246233, 112.15273407, 219.94946154, 172.54111566,
               46.49232858, 136.28493396, 107.12591954, 97.56499671,
               228.2457279, 97.07985653, 176.74828024, 31.27659918,
               174.69841549, 158.10166196, 177.17724282, 249.01773279,
               180.92068951, 65.12277397, 217.98698482, 227.12700932,
               252.09565084, 224.06539982, 120.01269493, 111.84217805,
               24.16470907, 175.35235799, 84.71791682, 167.30554155,
               110.8873606, 82.31456164, 3.00120939, 153.32901329,
               25.20004296, 87.71953145, 75.79332043, 28.14155362,
               2.92426413, 207.5350547, 60.39840413, 133.16850616,
               61.44222076, 189.49947724], [157.76153932, 20.7051002, 19.82370054, 198.07446814,
                                            199.16279302, 125.84507751, 135.53449575, 170.15849042,
                                            96.36549156, 190.61475267, 2.54007422, 165.57422714,
                                            30.50884128, 71.61280015, 63.5297374, 67.84020289,
                                            39.56207713, 108.23149654, 136.65277365, 103.66888711,
                                            32.76924336, 88.7342914, 75.60482117, 201.23450384,
                                            78.31155379, 117.29918521, 94.98184556, 145.27972597,
                                            142.92610901, 160.35547537, 205.33486389, 159.55209778,
                                            33.9490124, 114.97064262, 252.19394855, 93.2552186,
                                            94.4778275, 203.45154692, 180.16187606, 58.15172814,
                                            178.63724761, 204.90678889, 27.47928003, 134.87692695,
                                            77.96069922, 130.37934968, 190.06340874, 102.31657984,
                                            184.35187525, 153.18553611],
              [201.94253338, 252.89923438, 224.81570296, 202.44259752,
               164.96950066, 187.7774843, 164.08302187, 105.74041622,
               51.11920494, 239.8287975, 164.14805989, 85.56238104,
               13.54067064, 116.44022396, 73.5792442, 182.11881453,
               193.08844194, 230.13662457, 49.86465817, 239.85502968,
               98.04060583, 165.6427074, 73.91959111, 41.3239655,
               46.43929799, 89.45311802, 80.13734699, 21.98979022,
               146.88535033, 79.3245993, 120.48590775, 158.21176379,
               241.54493013, 188.79674505, 151.71386596, 4.41065643,
               189.86683133, 61.31000379, 213.10248951, 212.08489489,
               204.20426475, 20.20614494, 3.11434763, 33.58781937,
               197.42637327, 165.26890901, 56.68933915, 253.40301609,
               207.2506049, 76.46635597], [23.48615334, 74.86891429, 224.44415016, 164.15826912,
                                           114.34857238, 159.15593593, 51.11306135, 68.43998364,
                                           123.56698809, 146.75420109, 35.91061573, 75.4248846,
                                           74.53008923, 10.57947074, 130.5813552, 111.2191759,
                                           105.75175905, 90.31043154, 62.70497078, 54.68513512,
                                           88.86311363, 67.3597647, 106.00843601, 177.12778226,
                                           180.51439686, 246.88749443, 74.49380422, 135.86681876,
                                           235.74159112, 152.30921414, 219.16207223, 150.8715609,
                                           108.46544583, 59.3537477, 162.56580539, 61.45643255,
                                           224.40784779, 229.71284078, 131.00081094, 98.92532796,
                                           56.61439431, 119.88036732, 23.92060046, 215.13411382,
                                           62.12187401, 55.57766557, 247.57453084, 3.41580131,
                                           88.66645629, 97.99923822],
              [129.66897341, 106.93545142, 100.79325303, 86.42106653,
               141.05767008, 203.28706013, 215.8302648, 212.6438583,
               138.66278301, 64.0698396, 31.33928516, 166.31547384,
               184.74075706, 27.284656, 135.44073828, 160.81842718,
               224.93373568, 191.53602365, 158.34985315, 40.83279241,
               62.01450435, 112.07018418, 137.90890769, 158.39869668,
               57.84283501, 199.36273693, 104.47135309, 8.43067796,
               12.00737834, 129.77873934, 240.11737465, 230.37858532,
               61.61659236, 253.10670569, 75.85446424, 108.34269765,
               61.67734506, 114.62662881, 101.95050056, 47.40586406,
               126.56631189, 105.8568051, 67.19420523, 229.06925022,
               156.00659663, 34.14839322, 247.37214488, 160.12008599,
               215.19040075, 69.63677286], [252.71368262, 167.51310174, 225.74442248, 62.94983532,
                                            123.55859997, 35.07549609, 225.1668518, 35.05605866,
                                            65.29353945, 32.55176558, 134.58535694, 116.14498534,
                                            45.30208322, 248.67906075, 170.14220119, 50.33449623,
                                            27.1720803, 144.20180125, 221.44874688, 106.68951348,
                                            94.52612738, 165.59188475, 210.8167953, 84.1489739,
                                            185.2403911, 213.89758513, 115.79714147, 218.79722669,
                                            153.09673839, 227.07396839, 64.66295623, 190.99314573,
                                            153.55120663, 176.48615715, 134.86652478, 219.66691931,
                                            184.69339083, 60.62823047, 155.02736373, 64.7123603,
                                            66.38349877, 103.18070855, 197.45375694, 46.97084559,
                                            214.46776618, 219.13677337, 16.20144941, 78.65510758,
                                            127.23104184, 55.24965078],
              [174.5001698, 129.46043565, 122.59575626, 166.14821671,
               161.22770928, 50.60548676, 116.23592567, 94.12810307,
               222.75630707, 75.7538705, 103.38994314, 61.13086636,
               127.58110067, 211.33229038, 245.21386191, 195.03506103,
               11.56199226, 131.4280675, 189.46220326, 147.98987577,
               110.35868202, 114.94113031, 59.18475869, 97.12104691,
               138.36868214, 128.61686802, 11.11525165, 81.67974406,
               45.56170607, 98.92135228, 156.11930681, 210.97578677,
               225.49692838, 206.5172382, 214.98480523, 27.20236371,
               20.30895779, 143.80119062, 153.77235629, 138.73658454,
               56.465454, 63.58895944, 75.51536113, 132.79937494,
               111.85231468, 147.55478856, 46.24198544, 136.86575918,
               197.36740086, 190.96213519], [239.26170341, 215.04437303, 21.53744309, 239.79292824,
                                             134.33407812, 243.97074601, 33.76333925, 5.64670952,
                                             116.28495807, 33.50417157, 121.24903372, 164.29780948,
                                             239.69218059, 54.70350893, 84.49112803, 27.74861157,
                                             173.72722716, 178.39745982, 67.51502794, 160.3565208,
                                             201.64011155, 239.08072948, 135.64209787, 152.44820426,
                                             172.77764579, 40.23684435, 126.54310667, 208.47234434,
                                             216.64105863, 79.49488413, 93.50956778, 66.84877941,
                                             22.32854582, 102.80283986, 46.79576756, 38.63424858,
                                             185.58114545, 251.68471501, 30.07672025, 93.06187362,
                                             213.70151543, 95.40544482, 75.18745594, 196.55238418,
                                             37.45525224, 195.12604915, 30.49581467, 39.63407437,
                                             207.80692344, 29.21060054],
              [66.09911262, 97.59475611, 212.77179327, 245.36050535,
               89.33982793, 203.26462938, 138.60626085, 143.38801386,
               35.43820592, 173.04810349, 101.24929266, 38.38337047,
               126.41830019, 205.99807742, 236.21244341, 119.90086368,
               62.41747529, 120.78758897, 249.04698603, 2.34876734,
               248.10017962, 114.61677848, 85.313399, 172.65992384,
               63.52181052, 111.57821466, 178.4401883, 190.4065211,
               114.72845183, 245.63919083, 163.88511813, 37.93672646,
               217.75227974, 53.43011542, 130.03839743, 52.17792661,
               67.50631307, 116.08778293, 105.46106629, 222.52695704,
               148.97462092, 111.53451114, 155.86013723, 138.60403115,
               144.45407914, 83.68335426, 103.16155805, 80.91773764,
               10.91055174, 160.94152215], [171.52189238, 39.31208544, 119.29677829, 135.52069414,
                                            136.72336154, 7.73070799, 157.86045704, 116.87635562,
                                            140.3483922, 242.63846139, 90.18920362, 40.11774856,
                                            249.223527, 247.92386455, 21.13756803, 121.21929521,
                                            230.63134526, 42.87245717, 49.31394854, 115.81153291,
                                            155.70798101, 244.89478185, 150.17304734, 226.08925609,
                                            183.78040476, 131.57146743, 134.51106939, 25.02963964,
                                            188.648721, 100.54096522, 65.07599364, 132.91266389,
                                            95.3482365, 99.64734224, 138.60625356, 132.23896965,
                                            186.57816759, 146.07795838, 127.37783523, 82.13635576,
                                            110.40794032, 176.97604164, 165.76558683, 197.51502446,
                                            30.79650151, 244.79768128, 170.33593196, 178.97905405,
                                            176.24461741, 158.10030144],
              [7.59688862, 43.01318988, 36.50413877, 253.73855645,
               188.67917396, 247.75466144, 80.5012006, 147.35109292,
               57.38761614, 142.67699744, 45.58194862, 107.49292009,
               44.15666028, 39.73401828, 37.46912248, 161.77620004,
               206.65707885, 201.04927259, 133.01567969, 15.34934749,
               110.33080641, 171.81746186, 18.51260669, 140.11593308,
               198.6976928, 110.54753234, 233.05267937, 203.06372122,
               221.69920244, 121.18849599, 51.50290981, 109.54694134,
               84.70930773, 163.77401522, 208.52393724, 118.00871588,
               202.60372815, 82.30187574, 228.17546718, 191.6361982,
               20.65223877, 218.84032105, 76.81659682, 69.34714238,
               126.30449031, 170.76085044, 214.90281158, 146.67163195,
               66.50064632, 240.57702049], [64.19239814, 250.21863087, 23.25578274, 154.68121831,
                                            125.26574907, 136.3111025, 230.41452838, 23.17894694,
                                            23.22265183, 187.29072734, 206.60529102, 113.02273246,
                                            53.56523087, 7.3436799, 213.49624924, 123.35567891,
                                            104.67626171, 160.73714427, 252.97388794, 79.36166635,
                                            33.38651473, 145.19767977, 119.45966252, 203.12445092,
                                            25.59509037, 174.16789864, 105.43806692, 129.63865499,
                                            109.41340233, 179.05201002, 93.63597637, 209.0457309,
                                            50.5522284, 151.80702607, 227.39591016, 69.34008075,
                                            210.01546558, 199.97310675, 240.99271995, 165.46999936,
                                            239.9005259, 41.10623204, 221.63938253, 168.79862734,
                                            2.35981795, 228.41671752, 24.53617656, 235.0697031,
                                            111.32400406, 209.26881863],
              [11.51448688, 251.55662895, 79.58395438, 245.14796236,
               247.03079578, 213.95122809, 170.52563752, 114.82166181,
               223.98190607, 139.86619547, 81.63872679, 16.39930974,
               6.28467292, 94.65180451, 179.0481619, 233.96330364,
               35.05179138, 9.50395959, 29.69575371, 185.26359481,
               37.64203427, 215.53110997, 57.98407625, 149.35392795,
               196.12187457, 77.0264247, 156.32318468, 55.45351328,
               69.75719948, 232.45824397, 101.28718539, 224.18321895,
               179.9462592, 239.7562361, 120.43029424, 154.53716042,
               30.54111051, 158.40126672, 172.04587883, 227.38597151,
               233.46216834, 194.72321376, 1.20399291, 205.34077978,
               221.97704083, 8.33199872, 148.49266313, 165.50691618,
               236.72769934, 78.27587329], [101.59412984, 2.2882414, 253.92387631, 46.09786822,
                                            250.12267654, 74.96371461, 168.05716699, 248.00828168,
                                            241.01995478, 64.59413427, 36.54559299, 20.38971604,
                                            74.07467863, 4.97165781, 166.64440402, 163.05312187,
                                            61.9360916, 109.14550301, 215.48499159, 191.29822225,
                                            214.82586847, 25.28541259, 104.77368534, 32.38618504,
                                            37.52417558, 145.89370997, 206.77999757, 69.73477357,
                                            177.29578763, 171.30850397, 227.00371991, 124.39568135,
                                            64.16089732, 133.34439518, 25.83968246, 43.52170389,
                                            231.8755149, 64.11367588, 11.40564741, 165.76186757,
                                            21.436187, 224.75903492, 95.09205089, 233.50128922,
                                            90.89035914, 233.58042975, 237.28551765, 33.80829634,
                                            233.76452754, 4.42199356]]

# print(generate(population[0]))
print(len(population[0]))